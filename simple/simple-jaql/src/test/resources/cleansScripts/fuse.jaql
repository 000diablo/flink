using cleansing;

$personCluster = read 'personCluster.json';

abbr = fn(str, prefix) str + prefix;

$fusedPersons = fuse $personCluster
	/*into { 
		id: generateId('person'),
		lastName: [vote(abbr), longest],
		firstName: [vote(abbr), first],
		addresses: MergeAddresses,
		originalRecords: $[*].id
	}*/
	using weights for { 
		$member: 0.99,
		$sponsor: 0.99, 
		$sponsor: {
			addresses: 0.7
		}
	} 
	update $.relative[*].id in $ with id;

write $fusedPersons to hdfs('Persons.json');

using cleansing;

$persons = read 'persons.json';
$funds = read 'funds.json';
$legal_entity = read 'legal_entity.json';

join
	$sponsor in $persons,
	$relative in $persons,
	$fund in $funds,
	$recipient in $legal_entity,
	$subsidiary in $legal_entity
	where
	($relative.id in $sponsor.relatives[*].id or
	 $relative.id == $sponsor.id) and
	 $fund.id in $sponsor.enacted_funds[*].id and
	($subsidiary.id in $recipient.subsidiaries[*].id 
	or $subsidiary.id == $recipient.id)
	into {
	$sponsor.*,
	$relative.*
};
	 
